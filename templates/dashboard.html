{% extends "home.html" %}

{% load static %}
{% block content %}

<body>
    
    <div class="container">
        <img src="{% static 'images/graph.png' %}" alt="Graph" class="img-fluid">
    </div>
    <div id="kanban-board" class="kanban-board mt-4">
        <div class="kanban-stage" data-stage-id="1">
            <h4 class="text-center">Activities</h4>
            <div class="kanban-cards" id="stage-1">
                <div class="kanban-card" data-card-id="1">
                    <h5>Interest in your product</h5>
                    <p>The Jackson group</p>
                    <p>Revenue: $1000</p>
                    <button class="btn btn-primary archive-btn"><i class="fas fa-archive"></i> Archive</button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
                <div class="kanban-card" data-card-id="2">
                    <h5>One open space1</h5>
                    <p>Lumber</p>
                    <p>Revenue: $2000</p>
                    <button class="btn btn-primary archive-btn"><i class="fas fa-archive"></i> Archive</button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
                <div class="kanban-card" data-card-id="2">
                    <h5>One open space2</h5>
                    <p>Lumber</p>
                    <p>Revenue: $2000</p>
                    <button class="btn btn-primary archive-btn"><i class="fas fa-archive"></i> Archive</button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
                <div class="kanban-card" data-card-id="2">
                    <h5>One open space3</h5>
                    <p>Lumber</p>
                    <p>Revenue: $2000</p>
                    <button class="btn btn-primary archive-btn"><i class="fas fa-archive"></i> Archive</button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
                <div class="kanban-card" data-card-id="2">
                    <h5>One open space4</h5>
                    <p>Lumber</p>
                    <p>Revenue: $1008</p>
                    <button class="btn btn-primary archive-btn"><i class="fas fa-archive"></i> Archive</button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
                <!-- Add more cards as needed -->
            </div>
        </div>
    </div>


    <div id="trash-popup" class="trash-popup" style="display:none;">
        <i class="fas fa-trash trash-icon"></i>
        <p>Card has been Archived</p>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    
            // Initialize drag-and-drop functionality
            document.querySelectorAll('.kanban-cards').forEach(stage => {
                new Sortable(stage, {
                    group: 'kanban',
                    animation: 150,
                    onEnd: function (evt) {
                        var itemEl = evt.item;
    
                        // Show the popup and archive the card on drag end
                        showTrashPopup();
                        archiveCard(itemEl);
                    }
                });
            });
    
            function showTrashPopup() {
                const popup = document.getElementById('trash-popup');
                popup.style.display = 'flex';
                setTimeout(() => {
                    popup.style.display = 'none';
                }, 1500); // Show the popup for 1.5 seconds
            }
    
            function archiveCard(itemEl) {
                // Get card data
                const cardData = {
                    id: itemEl.getAttribute('data-card-id'),
                    title: itemEl.querySelector('h5').innerText,
                    description: itemEl.querySelector('p').innerText,
                    revenue: itemEl.querySelector('p:nth-of-type(2)').innerText
                };
    
                // Get current archived cards from local storage
                let archivedCards = JSON.parse(localStorage.getItem('archivedCards')) || [];
    
                // Add new card to archived cards
                archivedCards.push(cardData);
    
                // Save updated archived cards to local storage
                localStorage.setItem('archivedCards', JSON.stringify(archivedCards));
    
                // Remove card from DOM
                itemEl.remove();
            }
    
            document.querySelectorAll('.rating .fa-star').forEach(star => {
                star.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const card = this.closest('.kanban-card');
                    card.querySelectorAll('.fa-star').forEach(s => {
                        s.style.color = s.getAttribute('data-value') <= value ? '#ffc107' : '#e4e5e9';
                    });
                });
            });
    
            // Add event listeners for archive buttons
            document.querySelectorAll('.archive-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const card = this.closest('.kanban-card');
                    archiveCard(card);
                    showTrashPopup(card);
                });
            });
    
            // Remove archived cards on page load
            function removeArchivedCards() {
                const archivedCards = JSON.parse(localStorage.getItem('archivedCards')) || [];
                archivedCards.forEach(card => {
                    const cardElement = document.querySelector(`.kanban-card[data-card-id='${card.id}']`);
                    if (cardElement) {
                        cardElement.remove();
                    }
                });
            }
    
            // Call the function to remove archived cards
            removeArchivedCards();
        });
        </script>
</body>
{% endblock %}