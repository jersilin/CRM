{% extends "home.html" %}

{% load static %}
{% block content %}

<body>
    

    <div id="kanban-board" class="kanban-board">
        <div class="kanban-stage" data-stage-id="1">
            <h4>New</h4>
            <div class="kanban-cards" id="stage-1">
                <div class="kanban-card" data-card-id="1">
                    <h5>Interest in your product</h5>
                    <p>The Jackson group</p>
                    <p>Revenue: $1000</p>
                    <button class="btn btn-primary"><i class="fas fa-archive"></i> Archive</button>
                    <button class="btn btn-success"><i class="fas fa-info-circle"></i> Info</button>
                    <button class="btn btn-info"><i class="fas fa-phone-alt"></i></button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
                <div class="kanban-card" data-card-id="2">
                    <h5>One open space</h5>
                    <p>Lumber</p>
                    <p>Revenue: $2000</p>
                    <button class="btn btn-primary"><i class="fas fa-archive"></i> Archive</button>
                    <button class="btn btn-success"><i class="fas fa-info-circle"></i> Info</button>
                    <button class="btn btn-info"><i class="fas fa-phone-alt"></i></button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="kanban-stage" data-stage-id="2">
            <h4>Qualified</h4>
            <div class="kanban-cards" id="stage-2">
                <div class="kanban-card" data-card-id="3">
                    <h5>Access to online</h5>
                    <p>The ready mat</p>
                    <p>Revenue: $1500</p>
                    <button class="btn btn-primary"><i class="fas fa-archive"></i> Archive</button>
                    <button class="btn btn-success"><i class="fas fa-info-circle"></i> Info</button>
                    <button class="btn btn-info"><i class="fas fa-phone-alt"></i></button>
                    <div class="rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Popup Container -->
    <div id="popupContainer" class="popup-container">
        <div id="popupContent" class="popup-content">
            <h5 class="popup-title">Move Card Here</h5>
            <div id="popupCards" class="kanban-cards"></div>
            <button id="popupCloseBtn" class="btn btn-secondary">Close</button>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="moveCardModal" tabindex="-1" aria-labelledby="moveCardModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="moveCardModalLabel">Card Archived</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Card <span id="cardId"></span> has been archived.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/js/bootstrap.bundle.min.js"></script>
    <script>
    document.querySelectorAll('.kanban-cards').forEach(stage => {
        new Sortable(stage, {
            group: 'kanban',
            animation: 150,
            onEnd: function (evt) {
                var cardId = evt.item.getAttribute('data-card-id');
                var newStageId = evt.to.closest('.kanban-stage') ? evt.to.closest('.kanban-stage').getAttribute('data-stage-id') : 'popup';
                console.log('Card ID:', cardId, 'New Stage ID:', newStageId);
    
               
                document.getElementById('cardId').textContent = cardId;
    
                if (newStageId === 'popup') {
                   
                    var moveCardModal = new bootstrap.Modal(document.getElementById('moveCardModal'));
                    moveCardModal.show();
    
                    
                    document.getElementById('popupCards').appendChild(evt.item);
    
                  
                    document.getElementById('popupContainer').style.display = 'block';
    
                    setTimeout(() => {
                        moveCardModal.hide();
                    }, 3000);
                }
            }
        });
    });
    
    
    new Sortable(document.getElementById('popupCards'), {
        group: 'kanban',
        animation: 150,
        onAdd: function (evt) {
          
            console.log('Card moved to popup:', evt.item.getAttribute('data-card-id'));
        }
    });
    
  
    document.querySelectorAll('.rating .fa-star').forEach(star => {
        star.addEventListener('click', function() {
            const value = this.getAttribute('data-value');
            const card = this.closest('.kanban-card');
            card.querySelectorAll('.fa-star').forEach(s => {
                s.style.color = s.getAttribute('data-value') <= value ? '#ffc107' : '#e4e5e9';
            });
        });
    });
    
    
    document.getElementById('popupCloseBtn').addEventListener('click', function() {
        document.getElementById('popupContainer').style.display = 'none';
    });
    </script>
</body>

{% endblock %}