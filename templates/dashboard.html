{% extends "home.html" %}

{% load static %}
{% block content %}

<body>
    
    <div class="container">
        <img src="{% static 'images/graph.png' %}" alt="Graph" class="img-fluid">
    </div>
    
    <div id="kanban-board" class="kanban-board mt-4">
        <div class="kanban-stage" data-stage-id="1">
            <h4 class="text-center">Activities</h4>
            <div class="kanban-cards" id="stage-1">
                <div class="kanban-card" data-card-id="1">
                    <h5>Interest in your product</h5>
                    <p>The Jackson group</p>
                    <p>Revenue: $1000</p>
                </div>
                <div class="kanban-card" data-card-id="2">
                    <h5>One open space1</h5>
                    <p>Lumber</p>
                    <p>Revenue: $2000</p>
                </div>
                <div class="kanban-card" data-card-id="3">
                    <h5>One open space2</h5>
                    <p>Lumber</p>
                    <p>Revenue: $2000</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Archive Area (Trash Bin) -->
    <div id="archive-area" class="archive-area">
        <i class="fas fa-trash trash-icon"></i>
        <p class="text-primary">Drop here to archive</p>
    </div>
    
    
    <script>
  document.addEventListener('DOMContentLoaded', () => {
    const archiveArea = document.getElementById('archive-area');
    
    // Initialize drag-and-drop functionality
    document.querySelectorAll('.kanban-cards').forEach(stage => {
        new Sortable(stage, {
            group: 'kanban',
            animation: 150,
            ghostClass: 'sortable-ghost',
            chosenClass: 'sortable-chosen',
            dragClass: 'sortable-drag',
            onStart: function (evt) {
                evt.item.classList.add('dragging'); // Add dragging class to the card
                archiveArea.style.display = 'flex'; // Show the archive area when dragging starts
            },
            onEnd: function (evt) {
                evt.item.classList.remove('dragging'); // Remove dragging class from the card
                archiveArea.style.display = 'none'; // Hide the archive area when dragging ends
            },
            onMove: function (evt) {
                // Disable sorting when dragging over the archive area
                return !archiveArea.contains(evt.related);
            }
        });
    });

    // Handle the drag and drop events for archiving
    archiveArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        archiveArea.classList.add('dragover');
    });

    archiveArea.addEventListener('dragleave', () => {
        archiveArea.classList.remove('dragover');
    });

    archiveArea.addEventListener('drop', (e) => {
        e.preventDefault();
        archiveArea.classList.remove('dragover');

        const draggedCard = document.querySelector('.kanban-card.dragging');
        if (draggedCard) {
            archiveCard(draggedCard);
        }
    });

    function archiveCard(itemEl) {
        // Get card data
        const cardData = {
            id: itemEl.getAttribute('data-card-id'),
            title: itemEl.querySelector('h5').innerText,
            description: itemEl.querySelector('p').innerText,
            revenue: itemEl.querySelector('p:nth-of-type(2)').innerText
        };

        // Get current archived cards from local storage
        let archivedCards = JSON.parse(localStorage.getItem('archivedCards')) || [];

        // Add new card to archived cards
        archivedCards.push(cardData);

        // Save updated archived cards to local storage
        localStorage.setItem('archivedCards', JSON.stringify(archivedCards));

        // Remove card from DOM
        itemEl.remove();
    }

    // Remove archived cards on page load
    function removeArchivedCards() {
        const archivedCards = JSON.parse(localStorage.getItem('archivedCards')) || [];
        archivedCards.forEach(card => {
            const cardElement = document.querySelector(`.kanban-card[data-card-id='${card.id}']`);
            if (cardElement) {
                cardElement.remove();
            }
        });
    }

    // Call the function to remove archived cards
    removeArchivedCards();

    // Touch events handling for mobile devices
    document.querySelectorAll('.kanban-card').forEach(card => {
        card.addEventListener('touchstart', handleTouchStart, false);
        card.addEventListener('touchmove', handleTouchMove, false);
        card.addEventListener('touchend', handleTouchEnd, false);
    });

    let touchStartX, touchStartY, currentCard;

    function handleTouchStart(e) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        currentCard = e.target.closest('.kanban-card');
        currentCard.classList.add('dragging');
        archiveArea.style.display = 'flex'; // Show the archive area when dragging starts
    }

    function handleTouchMove(e) {
        e.preventDefault();
        const touchX = e.touches[0].clientX;
        const touchY = e.touches[0].clientY;
        const offsetX = touchX - touchStartX;
        const offsetY = touchY - touchStartY;

        currentCard.style.transform = `translate(${offsetX}px, ${offsetY}px)`;

        const archiveRect = archiveArea.getBoundingClientRect();
        const cardRect = currentCard.getBoundingClientRect();

        if (
            cardRect.top >= archiveRect.top &&
            cardRect.left >= archiveRect.left &&
            cardRect.bottom <= archiveRect.bottom &&
            cardRect.right <= archiveRect.right
        ) {
            archiveArea.classList.add('dragover');
        } else {
            archiveArea.classList.remove('dragover');
        }
    }

    function handleTouchEnd(e) {
        e.preventDefault();
        const archiveRect = archiveArea.getBoundingClientRect();
        const cardRect = currentCard.getBoundingClientRect();

        if (
            cardRect.top >= archiveRect.top &&
            cardRect.left >= archiveRect.left &&
            cardRect.bottom <= archiveRect.bottom &&
            cardRect.right <= archiveRect.right
        ) {
            archiveCard(currentCard);
        }

        currentCard.classList.remove('dragging');
        currentCard.style.transform = 'none';
        archiveArea.style.display = 'none'; // Hide the archive area when dragging ends
        archiveArea.classList.remove('dragover');
        currentCard = null;
    }
});



    </script>
    
</body>
{% endblock %}